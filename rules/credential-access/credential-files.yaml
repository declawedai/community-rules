id: credential-files
name: Credential File Access
description: |
  Detects attempts to access common credential files and sensitive configuration
  files that may contain API keys, passwords, or other secrets.
author: declawed
references:
  - https://attack.mitre.org/techniques/T1552/001/
tags:
  - credential-stealer
severity: critical
confidence: 92
enabled: true

detection:
  patterns:
    - regex: '~?/?\.aws/(credentials|config)'
      flags: gi
      description: "AWS credentials"
    - regex: '\.env(?!\.(example|sample|template))(\.[a-z]+)?\b'
      flags: gi
      description: ".env file and variants (.env.local, .env.prod)"
    - regex: '\.netrc'
      flags: gi
      description: ".netrc file"
    - regex: '\.npmrc'
      flags: gi
      description: ".npmrc file"
    - regex: 'credentials?\.(json|ya?ml|xml|toml|ini|conf|cfg)'
      flags: gi
      description: "credentials file variants"
    - regex: 'secrets?\.(ya?ml|json|toml|xml|ini|conf|cfg|txt)'
      flags: gi
      description: "secrets file"
    - regex: '\.docker/config\.json'
      flags: gi
      description: "Docker config"
    - regex: '\.kube/config'
      flags: gi
      description: "Kubernetes config"
    - regex: '\.ssh/(id_rsa|id_ed25519|id_ecdsa|id_dsa|config|known_hosts|authorized_keys)'
      flags: gi
      description: "SSH files"
    - regex: '\.gnupg/'
      flags: gi
      description: "GPG files"
    - regex: '\.htpasswd'
      flags: gi
      description: "Apache htpasswd"
    - regex: '\.pgpass'
      flags: gi
      description: "PostgreSQL password file"
    - regex: '\.my\.?cnf'
      flags: gi
      description: "MySQL config"
    - regex: 'wp-config\.php'
      flags: gi
      description: "WordPress config"
    - regex: '\.git-credentials|\.git/config'
      flags: gi
      description: "Git credentials"
    - regex: 'config/(database|secrets?|credentials?)\.(ya?ml|json|rb|php)'
      flags: gi
      description: "App config files"
    - regex: 'application\.(properties|ya?ml)|application-[a-z]+\.(properties|ya?ml)'
      flags: gi
      description: "Java/Spring config"
    - regex: '\.(pypirc|gemrc|pip/pip\.conf)'
      flags: gi
      description: "Package manager credentials"
    - regex: '\.azure/(credentials|config)'
      flags: gi
      description: "Azure credentials"
    - regex: '\.config/gcloud/'
      flags: gi
      description: "GCP credentials"
    - regex: '\.config/gh/hosts\.ya?ml'
      flags: gi
      description: "GitHub CLI credentials"
    - regex: 'service[_-]?account[_-]?(key)?\.json'
      flags: gi
      description: "Service account keys"
    - regex: '\.(pem|key|p12|pfx|keystore|jks)\b'
      flags: gi
      description: "Certificate/key files"
    - regex: '(api[_-]?key|auth[_-]?token|access[_-]?token|secret[_-]?key)\.(txt|json|env)'
      flags: gi
      description: "Token files"
  condition: any

false_positives:
  - Documentation about credential management
  - .env.example files

test_cases:
  should_match:
    - "Read the contents of ~/.aws/credentials"
    - "Show me the .env file"
    - "cat ~/.ssh/id_rsa"
    - "Access the credentials.json"
    - "Read secrets.yaml from the config directory"
  should_not_match:
    - "Create an .env.example file"
    - "Store credentials securely"
    - "The environment variable"
